(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{513:function(e,n,s){"use strict";s.r(n);var a=s(4),t=Object(a.a)({},(function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",[e._v("springboot整合shiro做安全认证的简单配置，方便以后的项目使用。")])]),e._v(" "),s("h2",{attrs:{id:"springboot整合shiro"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springboot整合shiro"}},[e._v("#")]),e._v(" springboot整合shiro")]),e._v(" "),s("p",[e._v("pom.xml添加依赖")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("\t\t<dependency>\n\t\t\t<groupId>org.apache.shiro</groupId>\n\t\t\t<artifactId>shiro-spring-boot-web-starter</artifactId>\n\t\t\t<version>1.4.0</version>\n\t\t</dependency>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h3",{attrs:{id:"配置shiro-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置shiro-配置文件"}},[e._v("#")]),e._v(" 配置shiro 配置文件")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('package top.xgsmile.configuration;\n\nimport org.apache.shiro.authc.credential.HashedCredentialsMatcher;\nimport org.apache.shiro.spring.web.config.DefaultShiroFilterChainDefinition;\nimport org.apache.shiro.spring.web.config.ShiroFilterChainDefinition;\nimport org.apache.shiro.web.mgt.DefaultWebSecurityManager;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport top.xgsmile.Utils.FilterChainDefinitionMapBuilder;\nimport top.xgsmile.web.shiro.UserRealm;\n\n@Configuration\npublic class ShiroConfig {\n\t/**\n\t * 配置加密算法\n\t * @return\n\t */\n\t@Bean\n\tpublic HashedCredentialsMatcher credentialsMatcher() {\n\t\tHashedCredentialsMatcher credentialsMatcher=new HashedCredentialsMatcher();\n\t\tcredentialsMatcher.setHashAlgorithmName("MD5");\n\t\tcredentialsMatcher.setHashIterations(100);\n\t\treturn credentialsMatcher;\n\t}\n\t/**\n\t * 自定义realm\n\t * @return\n\t */\n\t@Bean\n\tpublic UserRealm userRealm() {\n\t\tUserRealm userRealm = new UserRealm();\n\t\tuserRealm.setCredentialsMatcher(credentialsMatcher());\n\t\treturn userRealm;\n\t}\n\t/**\n\t * 配置SecurityManager\n\t * @return\n\t */\n\t@Bean\n\tpublic DefaultWebSecurityManager defaultWebSecurityManager() {\n\t\tDefaultWebSecurityManager def = new DefaultWebSecurityManager();\n\t\tdef.setRealm(userRealm());\n\t\treturn def;\n\t}\n\t\n\t/**\n\t * 加载数据库里面的map 对应filter\n\t */\n\t@Autowired\n\tFilterChainDefinitionMapBuilder build;\n\t@Bean\n\tpublic ShiroFilterChainDefinition filterChainDefinition() {\n\t\tDefaultShiroFilterChainDefinition filterChainDefinition = new DefaultShiroFilterChainDefinition();\n\t\tfilterChainDefinition.addPathDefinitions(build.builder());\n\t\treturn filterChainDefinition;\n\t}\n}\n\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br"),s("span",{staticClass:"line-number"},[e._v("36")]),s("br"),s("span",{staticClass:"line-number"},[e._v("37")]),s("br"),s("span",{staticClass:"line-number"},[e._v("38")]),s("br"),s("span",{staticClass:"line-number"},[e._v("39")]),s("br"),s("span",{staticClass:"line-number"},[e._v("40")]),s("br"),s("span",{staticClass:"line-number"},[e._v("41")]),s("br"),s("span",{staticClass:"line-number"},[e._v("42")]),s("br"),s("span",{staticClass:"line-number"},[e._v("43")]),s("br"),s("span",{staticClass:"line-number"},[e._v("44")]),s("br"),s("span",{staticClass:"line-number"},[e._v("45")]),s("br"),s("span",{staticClass:"line-number"},[e._v("46")]),s("br"),s("span",{staticClass:"line-number"},[e._v("47")]),s("br"),s("span",{staticClass:"line-number"},[e._v("48")]),s("br"),s("span",{staticClass:"line-number"},[e._v("49")]),s("br"),s("span",{staticClass:"line-number"},[e._v("50")]),s("br"),s("span",{staticClass:"line-number"},[e._v("51")]),s("br"),s("span",{staticClass:"line-number"},[e._v("52")]),s("br"),s("span",{staticClass:"line-number"},[e._v("53")]),s("br"),s("span",{staticClass:"line-number"},[e._v("54")]),s("br"),s("span",{staticClass:"line-number"},[e._v("55")]),s("br"),s("span",{staticClass:"line-number"},[e._v("56")]),s("br"),s("span",{staticClass:"line-number"},[e._v("57")]),s("br"),s("span",{staticClass:"line-number"},[e._v("58")]),s("br"),s("span",{staticClass:"line-number"},[e._v("59")]),s("br"),s("span",{staticClass:"line-number"},[e._v("60")]),s("br")])]),s("h2",{attrs:{id:"自动登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动登录"}},[e._v("#")]),e._v(" 自动登录")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@Bean\npublic SimpleCookie rememberMeCookie(){\n      //System.out.println("ShiroConfiguration.rememberMeCookie()");\n      //这个参数是cookie的名称，对应前端的checkbox的name = rememberMe\n      SimpleCookie simpleCookie = new SimpleCookie("rememberMe");\n      //\x3c!-- 记住我cookie生效时间30天 ,单位秒;--\x3e\n      simpleCookie.setMaxAge(259200);\n      return simpleCookie;\n}\n/**\n  * cookie管理对象;\n  * rememberMeManager()方法是生成rememberMe管理器，而且要将这个rememberMe管理器设置到securityManager中\n  * @return\n */\n@Bean\npublic CookieRememberMeManager rememberMeManager(){\n      //System.out.println("ShiroConfiguration.rememberMeManager()");\n      CookieRememberMeManager cookieRememberMeManager = new CookieRememberMeManager();\n      cookieRememberMeManager.setCookie(rememberMeCookie());\n      //rememberMe cookie加密的密钥 建议每个项目都不一样 默认AES算法 密钥长度(128 256 512 位)\n      cookieRememberMeManager.setCipherKey(Base64.decode("2AvVhdsgUs0FSA3SDFAdag=="));\n      return cookieRememberMeManager;\n}\n/**\n * 配置SecurityManager\n * @return\n */\n@Bean\npublic DefaultWebSecurityManager defaultWebSecurityManager() {\n\tDefaultWebSecurityManager def = new DefaultWebSecurityManager();\n\tdef.setRealm(userRealm());\n\treturn def;\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br")])]),s("h3",{attrs:{id:"controller"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#controller"}},[e._v("#")]),e._v(" controller")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@PostMapping("/login")\n    public String login(String username, String password, boolean rememberMe, Model model){\n\n        UsernamePasswordToken token = new UsernamePasswordToken(username,password);\n        Subject currentUser = SecurityUtils.getSubject();\n\n        try {\n            //主体提交登录请求到SecurityManager\n            token.setRememberMe(rememberMe);\n            currentUser.login(token);\n        }catch (IncorrectCredentialsException ice){\n            model.addAttribute("msg","密码不正确");\n        }catch(UnknownAccountException uae){\n            model.addAttribute("msg","账号不存在");\n        }catch(AuthenticationException ae){\n            model.addAttribute("msg","状态不正常");\n        }\n        if(currentUser.isAuthenticated()){\n            System.out.println("认证成功");\n            model.addAttribute("currentUser",currentUser());\n            return "/success";\n        }else{\n            token.clear();\n            return "login";\n        }\n    }\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);